<div *ngIf="data" class="bg-white rounded-2xl border border-gray-100 overflow-hidden"
     style="box-shadow: 0 8px 40px rgba(91, 15, 20, 0.08);">

  <!-- ================= HEADER ================= -->
  <div class="bg-gradient-to-br from-gray-50 to-white px-8 pt-8 pb-7 border-b border-gray-200/80">
    <div class="flex flex-col lg:flex-row lg:items-start justify-between gap-6">

      <!-- Left: Title & Basic Info -->
      <div class="flex-1">
        <!-- Breadcrumb -->
        <div class="flex items-center gap-2 text-sm text-gray-500 mb-4">
          <span class="font-medium">Resource Allocation System</span>
          <mat-icon class="!text-base !w-4 !h-4 text-gray-400">chevron_right</mat-icon>
          <span>Project Management</span>
          <mat-icon class="!text-base !w-4 !h-4 text-gray-400">chevron_right</mat-icon>
          <span class="text-gray-700 font-semibold">Project Details</span>
        </div>

        <!-- Project Title -->
        <div class="flex items-start gap-4 mb-4">
          <div class="flex-shrink-0 w-14 h-14 rounded-xl bg-gradient-to-br from-[#5b0f14]/10 to-[#7a1419]/20 
                    flex items-center justify-center shadow-sm">
            <mat-icon class="!text-2xl text-[#5b0f14]">folder_special</mat-icon>
          </div>
          <div>
            <h1 class="text-2xl font-bold text-gray-900 mb-1.5">
              {{ data[config.titleKey] }}
            </h1>
            <div class="flex flex-wrap items-center gap-x-4 gap-y-2 text-sm text-gray-600">
              <!-- Use config.subtitleKeys -->
              <span *ngFor="let key of config.subtitleKeys; let last = last">
                {{ data[key] }}
                <span *ngIf="!last" class="mx-2">•</span>
              </span>
            </div>
          </div>
        </div>

        <!-- Key Metrics Bar -->
        <div class="flex flex-wrap items-center gap-4 mt-6">
          <div class="flex items-center gap-2 px-3 py-1.5 bg-gray-100 rounded-lg">
            <mat-icon class="!text-base !w-4 !h-4 text-[#5b0f14]">calendar_today</mat-icon>
            <span class="text-sm font-semibold text-gray-700">Start:</span>
            <span class="text-sm text-gray-900">{{ getFormattedDate('projectStartDate') }}</span>
          </div>
          <div class="flex items-center gap-2 px-3 py-1.5 bg-gray-100 rounded-lg">
            <mat-icon class="!text-base !w-4 !h-4 text-[#5b0f14]">event_available</mat-icon>
            <span class="text-sm font-semibold text-gray-700">End:</span>
            <span class="text-sm text-gray-900">{{ getFormattedDate('projectEndDate') }}</span>
          </div>
          <div class="flex items-center gap-2 px-3 py-1.5 bg-gray-100 rounded-lg">
            <mat-icon class="!text-base !w-4 !h-4 text-[#5b0f14]">timeline</mat-icon>
            <span class="text-sm font-semibold text-gray-700">Tenure:</span>
            <span class="text-sm text-gray-900">{{ data.projectTenure || '—' }} Months</span>
          </div>
          <!-- Requirements Count -->
          <div class="flex items-center gap-2 px-3 py-1.5 bg-gray-100 rounded-lg">
            <mat-icon class="!text-base !w-4 !h-4 text-[#5b0f14]">assignment</mat-icon>
            <span class="text-sm font-semibold text-gray-700">Requirements:</span>
            <span class="text-sm text-gray-900">
              {{ getTotalRequiredFromRoles() || data.requirements?.requiredHeadcount || '0' }} Positions
            </span>
          </div>
        </div>
      </div>

      <!-- Right: Status & Stats -->
      <div class="lg:text-right">
        <!-- Status Badge -->
        <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-bold 
                    uppercase tracking-wide mb-4 shadow-sm" [ngClass]="getStatusClass()">
          <div class="w-2 h-2 rounded-full bg-current opacity-80"></div>
          {{ data[config.status.key] }}
        </div>

        <!-- Quick Stats -->
        <div class="flex lg:flex-col items-center lg:items-end gap-4 mt-4">
          <div class="text-center lg:text-right">
            <div class="text-2xl font-bold text-gray-900">{{ getResourceCount() }}</div>
            <div class="text-xs text-gray-500">Resources</div>
          </div>
          <div class="hidden lg:block w-px h-8 bg-gray-300"></div>
          <div class="text-center lg:text-right">
            <div class="text-2xl font-bold text-gray-900">{{ getCompletion() }}%</div>
            <div class="text-xs text-gray-500">Progress</div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- ================= ACTION BAR ================= -->
 <div *ngIf="config.actions?.length"
     class="px-8 py-4 bg-white border-b border-gray-200/80 flex items-center justify-between">
  <div class="flex gap-2">
    <!-- Dynamic buttons from config -->
    <atom-button
      *ngFor="let act of config.actions"
      [label]="act.label"
      [variant]="act.variant"
      [icon]="act.icon"
      [size]="act.size || 'md'"
      [bgColor]="act.bgcolor || ''"
      [textColor]="act.textColor || ''"
      [borderColor]="act.borderColor || ''"
      [disabled]="act.disabled || false"
      (onClick)="emitAction(act.action)"
      class="shadow-sm hover:shadow-md active:scale-95 transition-transform">
    </atom-button>
  </div>

  <!-- Additional Actions -->
  <div class="flex items-center gap-2">
    <atom-button
      variant="light"
      icon="print"
      [iconOnly]="true"
      size="sm"
      (onClick)="emitAction('print')"
      title="Print">
    </atom-button>
    
    <atom-button
      variant="light"
      icon="download"
      [iconOnly]="true"
      size="sm"
      (onClick)="emitAction('export')"
      title="Export">
    </atom-button>
  </div>
</div>

  <!-- ================= MAIN CONTENT ================= -->
  <div class="p-8">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      
      <!-- Left Column: Project Details -->
      <div class="lg:col-span-2 space-y-8">
        
        <!-- Project Overview from Config -->
        <div *ngIf="getOverviewSection()" class="bg-gradient-to-br from-gray-50 to-white rounded-xl border border-gray-200 p-6">
          <div class="flex items-center gap-3 mb-6">
            <div class="w-1.5 h-6 bg-[#5b0f14] rounded-full"></div>
            <h2 class="text-lg font-bold text-gray-900">{{ getOverviewSection()!.title || 'Project Overview' }}</h2>
          </div>
          
          <!-- Info Grid from Config -->
          <div class="grid gap-4" [ngClass]="{
            'grid-cols-1': getOverviewSection()!.columns === 1,
            'grid-cols-1 md:grid-cols-2': getOverviewSection()!.columns === 2,
            'grid-cols-1 md:grid-cols-2 lg:grid-cols-3': getOverviewSection()!.columns === 3
          }">
            <div *ngFor="let field of getOverviewSection()!.fields || []" 
                 class="p-4 rounded-lg border border-gray-200 hover:border-[#5b0f14]/30 
                        transition-all duration-200 bg-white">
              <div class="flex items-center gap-3 mb-2">
                <div *ngIf="field.icon" class="w-8 h-8 rounded-lg bg-gray-100 flex items-center justify-center">
                  <mat-icon class="!text-base text-[#5b0f14]">{{ field.icon }}</mat-icon>
                </div>
                <div>
                  <div class="text-xs font-semibold text-gray-500 uppercase tracking-wide">
                    {{ field.label }}
                  </div>
                  <div class="text-base font-bold text-gray-900 mt-0.5">
                    {{ formatValue(field) }}
                  </div>
                </div>
              </div>
              <div *ngIf="field.hint" class="text-xs text-gray-500 mt-1">{{ field.hint }}</div>
            </div>
          </div>
        </div>

        <!-- Requirements Section -->
        <div class="bg-gradient-to-br from-gray-50 to-white rounded-xl border border-gray-200 overflow-hidden">
          <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
            <div class="flex items-center justify-between">
              <div>
                <h2 class="text-lg font-bold text-gray-900 flex items-center gap-2">
                  <mat-icon class="!text-base text-[#5b0f14]">assignment</mat-icon>
                  Project Requirements
                </h2>
                <p class="text-sm text-gray-600 mt-1">Detailed resource requirements for this project</p>
              </div>
              <span *ngIf="data.requirements" class="text-xs font-semibold px-2.5 py-1 rounded-full 
                    bg-gradient-to-r from-[#5b0f14]/10 to-[#7a1419]/10 text-[#5b0f14] border border-[#5b0f14]/20">
                {{ getTotalRequiredFromRoles() || data.requirements.requiredHeadcount || '0' }} Position(s)
              </span>
            </div>
          </div>

          <div *ngIf="data.requirements; else noRequirements" class="p-6">
            <!-- Requirements Overview -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
              <div class="p-4 rounded-lg border border-gray-200 bg-white hover:border-[#5b0f14]/30 transition-colors">
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 rounded-lg bg-[#5b0f14]/10 flex items-center justify-center">
                    <mat-icon class="!text-base text-[#5b0f14]">business</mat-icon>
                  </div>
                  <div>
                    <div class="text-xs font-semibold text-gray-500 uppercase">Work Type</div>
                    <div class="text-base font-bold text-gray-900">{{ data.requirements.workType }}</div>
                  </div>
                </div>
              </div>

              <div class="p-4 rounded-lg border border-gray-200 bg-white hover:border-[#5b0f14]/30 transition-colors">
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 rounded-lg bg-[#5b0f14]/10 flex items-center justify-center">
                    <mat-icon class="!text-base text-[#5b0f14]">location_on</mat-icon>
                  </div>
                  <div>
                    <div class="text-xs font-semibold text-gray-500 uppercase">Location</div>
                    <div class="text-base font-bold text-gray-900">{{ data.requirements.officeLocation || 'Not specified' }}</div>
                  </div>
                </div>
              </div>

              <div class="p-4 rounded-lg border border-gray-200 bg-white hover:border-[#5b0f14]/30 transition-colors">
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 rounded-lg bg-[#5b0f14]/10 flex items-center justify-center">
                    <mat-icon class="!text-base text-[#5b0f14]">schedule</mat-icon>
                  </div>
                  <div>
                    <div class="text-xs font-semibold text-gray-500 uppercase">Attendance</div>
                    <div class="text-base font-bold text-gray-900">{{ data.requirements.attendanceMode }}</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Customer Presence -->
            <div class="mb-6 p-4 rounded-lg border border-gray-200 bg-white">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <div class="w-8 h-8 rounded-lg bg-[#5b0f14]/10 flex items-center justify-center">
                    <mat-icon class="!text-base text-[#5b0f14]">people</mat-icon>
                  </div>
                  <div>
                    <div class="text-sm font-semibold text-gray-900">Customer Presence Required</div>
                    <div class="text-xs text-gray-500">Whether client representatives need to be onsite</div>
                  </div>
                </div>
                <div [ngClass]="data.requirements.customerPresenceRequired 
                      ? 'bg-green-100 text-green-800' 
                      : 'bg-gray-100 text-gray-800'"
                     class="px-3 py-1 rounded-full text-xs font-semibold">
                  {{ data.requirements.customerPresenceRequired ? 'Yes' : 'No' }}
                </div>
              </div>
            </div>

            <!-- Required Roles & Experience -->
            <div class="border-t border-gray-200 pt-6">
              <h3 class="text-sm font-bold text-gray-900 mb-4 flex items-center gap-2">
                <mat-icon class="!text-base text-[#5b0f14]">engineering</mat-icon>
                Required Roles & Experience
              </h3>
              
              <div *ngIf="getRoleExperienceMap()?.length; else noRoles" class="space-y-3">
                <div *ngFor="let role of getRoleExperienceMap()" 
                     class="p-4 rounded-lg border border-gray-200 bg-white hover:border-[#5b0f14]/30 transition-colors">
                  <div class="flex items-start justify-between">
                    <div class="flex-1">
                      <div class="flex items-center gap-2 mb-3">
                        <div class="w-6 h-6 rounded-md bg-[#5b0f14]/10 flex items-center justify-center">
                          <mat-icon class="!text-xs text-[#5b0f14]">badge</mat-icon>
                        </div>
                        <span class="font-semibold text-gray-900 text-sm">{{ getRoleDisplayName(role) }}</span>
                        <div *ngIf="role.requiredCount" class="ml-2 px-2 py-0.5 bg-[#5b0f14]/10 text-[#5b0f14] text-xs font-semibold rounded">
                          {{ role.requiredCount }} required
                        </div>
                      </div>
                      <div class="grid grid-cols-1 md:grid-cols-3 gap-3 text-sm">
                        <div>
                          <span class="text-gray-500">Experience:</span>
                          <span class="font-medium text-gray-900 ml-2">{{ getRoleExperience(role) }}</span>
                        </div>
                        <div>
                          <span class="text-gray-500">Qualification:</span>
                          <span class="font-medium text-gray-900 ml-2">{{ getRoleQualification(role) }}</span>
                        </div>
                        <div>
                          <span class="text-gray-500">Skills:</span>
                          <span class="font-medium text-gray-900 ml-2">{{ getRoleSkills(role) }}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <ng-template #noRoles>
                <div class="text-center py-8 text-gray-500">
                  <mat-icon class="!text-3xl text-gray-300 mb-2">info</mat-icon>
                  <p>No specific roles defined</p>
                </div>
              </ng-template>
            </div>

            <!-- Metadata -->
            <div class="mt-6 pt-6 border-t border-gray-200 text-xs text-gray-500">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                  <span class="flex items-center gap-1">
                    <mat-icon class="!text-xs">calendar_today</mat-icon>
                    Created: {{ getFormattedDate(data.requirements.createdAt) }}
                  </span>
                  <span class="flex items-center gap-1">
                    <mat-icon class="!text-xs">update</mat-icon>
                    Updated: {{ getFormattedDate(data.requirements.updatedAt) }}
                  </span>
                </div>
                <button (click)="emitAction('viewRequirementDetails')" 
                        class="text-[#5b0f14] hover:text-[#7a1419] font-medium flex items-center gap-1">
                  View Details
                  <mat-icon class="!text-xs">chevron_right</mat-icon>
                </button>
              </div>
            </div>
          </div>

          <ng-template #noRequirements>
            <div class="p-8 text-center">
              <div class="w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-4">
                <mat-icon class="!text-2xl text-gray-400">assignment</mat-icon>
              </div>
              <h3 class="text-lg font-semibold text-gray-700 mb-2">No Requirements Defined</h3>
              <p class="text-gray-500 mb-6 max-w-md mx-auto">
                Add project requirements to define the roles, skills, and resources needed for this project.
              </p>
              <atom-button
                label="Define Project Requirements"
                variant="primary"
                icon="add_circle"
                size="md"
                bgColor="#5b0f14"
                textColor="white"
                (onClick)="emitAction('addRequirements')"
                class="mx-auto">
              </atom-button>
            </div>
          </ng-template>
        </div>

        <!-- Custom Slot Area -->
        <ng-container *ngIf="hasCustomSection()">
          <div class="bg-white rounded-xl border border-gray-200 overflow-hidden">
            <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
              <h2 class="text-lg font-bold text-gray-900">Resource Allocation</h2>
              <p class="text-sm text-gray-600 mt-1">Manage team members assigned to this project</p>
            </div>
            <div class="p-6">
              <ng-content></ng-content>
            </div>
          </div>
        </ng-container>

      </div>

      <!-- Right Column: Side Panel -->
      <div class="space-y-6">
        
        <!-- Project Timeline -->
        <div class="bg-white rounded-xl border border-gray-200 p-5">
          <div class="flex items-center justify-between mb-4">
            <h3 class="font-bold text-gray-900 flex items-center gap-2">
              <mat-icon class="!text-base text-[#5b0f14]">timeline</mat-icon>
              Timeline
            </h3>
            <span class="text-xs font-semibold px-2 py-1 rounded-full bg-gray-100 text-gray-700">
              {{ getDaysRemaining() }} days left
            </span>
          </div>
          
          <!-- Progress Bar -->
          <div class="mb-4">
            <div class="flex justify-between text-xs text-gray-600 mb-1">
              <span>Progress</span>
              <span>{{ getCompletion() }}%</span>
            </div>
            <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
              <div class="h-full bg-gradient-to-r from-[#5b0f14] to-[#7a1419] rounded-full" 
                   [style.width]="getCompletion() + '%'"></div>
            </div>
          </div>
          
          <!-- Timeline Dates -->
          <div class="space-y-3">
            <div class="flex items-center justify-between py-2 border-b border-gray-100">
              <span class="text-sm text-gray-600">Start Date</span>
              <span class="text-sm font-semibold text-gray-900">
                {{ getFormattedDate('projectStartDate') }}
              </span>
            </div>
            <div class="flex items-center justify-between py-2 border-b border-gray-100">
              <span class="text-sm text-gray-600">End Date</span>
              <span class="text-sm font-semibold text-gray-900">
                {{ getFormattedDate('projectEndDate') }}
              </span>
            </div>
            <div class="flex items-center justify-between py-2">
              <span class="text-sm text-gray-600">Duration</span>
              <span class="text-sm font-semibold text-gray-900">{{ data.projectTenure || '—' }} months</span>
            </div>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="bg-gradient-to-br from-gray-50 to-white rounded-xl border border-gray-200 p-5">
          <h3 class="font-bold text-gray-900 mb-4 flex items-center gap-2">
            <mat-icon class="!text-base text-[#5b0f14]">flash_on</mat-icon>
            Quick Actions
          </h3>
          
          <div class="space-y-2">
            <button (click)="emitAction('addEmployee')"
                    class="w-full flex items-center gap-3 p-3 rounded-lg hover:bg-white hover:shadow-sm 
                           border border-gray-200 hover:border-[#5b0f14]/30 transition-all duration-200 text-left">
              <div class="w-8 h-8 rounded-lg bg-gray-100 flex items-center justify-center">
                <mat-icon class="!text-base text-[#5b0f14]">person_add</mat-icon>
              </div>
              <div class="flex-1">
                <div class="text-sm font-medium text-gray-900">Add Employee</div>
                <div class="text-xs text-gray-500">Assign team member from employee list</div>
              </div>
            </button>
            
            <button (click)="emitAction('viewTeam')"
                    class="w-full flex items-center gap-3 p-3 rounded-lg hover:bg-white hover:shadow-sm 
                           border border-gray-200 hover:border-[#5b0f14]/30 transition-all duration-200 text-left">
              <div class="w-8 h-8 rounded-lg bg-gray-100 flex items-center justify-center">
                <mat-icon class="!text-base text-[#5b0f14]">groups</mat-icon>
              </div>
              <div class="flex-1">
                <div class="text-sm font-medium text-gray-900">View Team</div>
                <div class="text-xs text-gray-500">See all assigned resources</div>
              </div>
            </button>
            
            <button *ngIf="data.requirements" (click)="emitAction('matchResources')"
                    class="w-full flex items-center gap-3 p-3 rounded-lg hover:bg-white hover:shadow-sm 
                           border border-gray-200 hover:border-[#5b0f14]/30 transition-all duration-200 text-left">
              <div class="w-8 h-8 rounded-lg bg-gradient-to-r from-[#5b0f14]/10 to-[#7a1419]/10 flex items-center justify-center">
                <mat-icon class="!text-base text-[#5b0f14]">connect_without_contact</mat-icon>
              </div>
              <div class="flex-1">
                <div class="text-sm font-medium text-gray-900">Match Resources</div>
                <div class="text-xs text-gray-500">Find employees matching requirements</div>
              </div>
            </button>
            
            <button (click)="emitAction('updateProgress')"
                    class="w-full flex items-center gap-3 p-3 rounded-lg hover:bg-white hover:shadow-sm 
                           border border-gray-200 hover:border-[#5b0f14]/30 transition-all duration-200 text-left">
              <div class="w-8 h-8 rounded-lg bg-gray-100 flex items-center justify-center">
                <mat-icon class="!text-base text-[#5b0f14]">trending_up</mat-icon>
              </div>
              <div class="flex-1">
                <div class="text-sm font-medium text-gray-900">Update Progress</div>
                <div class="text-xs text-gray-500">Modify project completion</div>
              </div>
            </button>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<!-- CSS Styles -->
<style>
.status-active {
  background: linear-gradient(135deg, rgba(91, 15, 20, 0.1) 0%, rgba(122, 20, 25, 0.1) 100%);
  color: #5b0f14;
  border: 1px solid rgba(91, 15, 20, 0.2);
}

.status-completed {
  background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.1) 100%);
  color: #059669;
  border: 1px solid rgba(5, 150, 105, 0.2);
}

.status-onhold {
  background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(217, 119, 6, 0.1) 100%);
  color: #d97706;
  border: 1px solid rgba(217, 119, 6, 0.2);
}

.status-neutral {
  background: linear-gradient(135deg, rgba(107, 114, 128, 0.1) 0%, rgba(75, 85, 99, 0.1) 100%);
  color: #4b5563;
  border: 1px solid rgba(75, 85, 99, 0.2);
}
</style>