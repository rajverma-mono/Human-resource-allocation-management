<div class="fixed inset-0 z-50 overflow-hidden" *ngIf="isOpen">
  <!-- Backdrop -->
  <div class="absolute inset-0 bg-black/40 transition-opacity" 
       (click)="close()"></div>
  
  <!-- Panel Container -->
  <div class="absolute inset-y-0 right-0 flex max-w-full">
    <!-- Panel -->
    <div class="relative w-screen max-w-md transform transition-transform duration-300 ease-in-out">
      
      <div class="flex h-full flex-col bg-white shadow-xl">
        
        <!-- Header -->
        <div class="px-6 py-5 bg-gradient-to-r from-gray-50 to-white border-b border-gray-200">
          <div class="flex items-center justify-between">
            <div>
              <h2 class="text-lg font-bold text-gray-900">{{ config?.title || 'Requirements' }}</h2>
              <p class="text-sm text-gray-600 mt-1">{{ config?.description || '' }}</p>
            </div>
            <button (click)="close()" 
                    class="rounded-full p-1.5 hover:bg-gray-100 transition-colors">
              <mat-icon class="!text-xl text-gray-500">close</mat-icon>
            </button>
          </div>
        </div>
        
        <!-- Form Content -->
        <div class="flex-1 overflow-y-auto p-6">
          <form [formGroup]="requirementsForm" class="space-y-6">
            
            <ng-container *ngFor="let field of config?.fields || []">
              
              <!-- Text Input -->
              <div *ngIf="field.type === 'text'" class="form-field">
                <mat-form-field appearance="outline" class="w-full">
                  <mat-label>{{ field.label }}</mat-label>
                  <input matInput 
                         [formControlName]="field.key"
                         [placeholder]="field.placeholder || ''"
                         [readonly]="field.readonly || false"
                         [disabled]="field.disabled || false">
                  <mat-hint *ngIf="field.hint">{{ field.hint }}</mat-hint>
                  <mat-error *ngIf="requirementsForm.get(field.key)?.hasError('required')">
                    {{ field.label }} is required
                  </mat-error>
                </mat-form-field>
              </div>
              
              <!-- Number Input -->
              <div *ngIf="field.type === 'number'" class="form-field">
                <mat-form-field appearance="outline" class="w-full">
                  <mat-label>{{ field.label }}</mat-label>
                  <input matInput 
                         type="number"
                         [formControlName]="field.key"
                         [placeholder]="field.placeholder || ''"
                         [min]="field.min || null"
                         [max]="field.max || null"
                         [step]="field.step || 1">
                  <mat-hint *ngIf="field.hint">{{ field.hint }}</mat-hint>
                  <mat-error *ngIf="requirementsForm.get(field.key)?.hasError('required')">
                    {{ field.label }} is required
                  </mat-error>
                  <mat-error *ngIf="requirementsForm.get(field.key)?.hasError('min')">
                    Minimum value is {{ field.min }}
                  </mat-error>
                  <mat-error *ngIf="requirementsForm.get(field.key)?.hasError('max')">
                    Maximum value is {{ field.max }}
                  </mat-error>
                </mat-form-field>
              </div>
              
              <!-- Select Dropdown -->
              <div *ngIf="field.type === 'select'" class="form-field">
                <mat-form-field appearance="outline" class="w-full">
                  <mat-label>{{ field.label }}</mat-label>
                  <mat-select [formControlName]="field.key">
                    <mat-option *ngFor="let option of field.options || []" [value]="option.value">
                      {{ option.label }}
                    </mat-option>
                  </mat-select>
                  <mat-error *ngIf="requirementsForm.get(field.key)?.hasError('required')">
                    {{ field.label }} is required
                  </mat-error>
                </mat-form-field>
              </div>
              
              <!-- Radio Group -->
              <div *ngIf="field.type === 'radio-group'" class="form-field">
                <div class="mb-2">
                  <label class="text-sm font-medium text-gray-700">{{ field.label }}</label>
                  <span *ngIf="field.required" class="text-red-500 ml-1">*</span>
                </div>
                <mat-radio-group [formControlName]="field.key" class="flex flex-col gap-2">
                  <mat-radio-button *ngFor="let option of field.options || []" 
                                    [value]="option.value"
                                    class="mb-1">
                    {{ option.label }}
                  </mat-radio-button>
                </mat-radio-group>
                <mat-error *ngIf="requirementsForm.get(field.key)?.hasError('required')" class="text-xs text-red-600 mt-1">
                  Please select {{ field.label }}
                </mat-error>
              </div>
              
              <!-- Toggle Switch -->
              <div *ngIf="field.type === 'toggle'" class="form-field">
                <div class="flex items-center justify-between py-2">
                  <div>
                    <label class="text-sm font-medium text-gray-700">{{ field.label }}</label>
                    <span *ngIf="field.required" class="text-red-500 ml-1">*</span>
                  </div>
                  <mat-slide-toggle [formControlName]="field.key"></mat-slide-toggle>
                </div>
              </div>
              
              <!-- Chip Input for Skills -->
              <div *ngIf="field.type === 'chip-input'" class="form-field">
                <mat-form-field appearance="outline" class="w-full">
                  <mat-label>{{ field.label }}</mat-label>
                  <mat-chip-grid #chipGrid [formControlName]="field.key">
                    <mat-chip-row *ngFor="let skill of requirementsForm.get(field.key)?.value || []"
                                  (removed)="removeSkill(skill)">
                      {{ skill }}
                      <button matChipRemove>
                        <mat-icon>cancel</mat-icon>
                      </button>
                    </mat-chip-row>
                    <input [placeholder]="field.placeholder || ''"
                           [matChipInputFor]="chipGrid"
                           [matChipInputSeparatorKeyCodes]="[13, 188]"
                           (matChipInputTokenEnd)="addSkill($event)"
                           class="mt-1"/>
                  </mat-chip-grid>
                  <mat-hint>{{ field.hint || 'Type and press Enter to add skills' }}</mat-hint>
                  <mat-error *ngIf="requirementsForm.get(field.key)?.hasError('required')">
                    At least one skill is required
                  </mat-error>
                </mat-form-field>
              </div>
              
            </ng-container>
          </form>
        </div>
        
        <!-- Footer Actions -->
        <div class="px-6 py-4 border-t border-gray-200 bg-gray-50/50">
          <div class="flex justify-end gap-3">
            <button *ngFor="let act of config?.actions || []"
                    (click)="onAction(act.action)"
                    class="px-4 py-2 rounded-lg text-sm font-semibold transition-all duration-200 
                           shadow-sm hover:shadow-md active:scale-95 flex items-center gap-2"
                    [ngClass]="
                      act.variant === 'primary'
                        ? 'bg-gradient-to-r from-[#5b0f14] to-[#7a1419] text-white hover:from-[#7a1419] hover:to-[#5b0f14]'
                        : 'bg-white border border-gray-300 text-gray-700 hover:border-[#5b0f14] hover:text-[#5b0f14]'
                    ">
              <mat-icon *ngIf="act.icon" class="!text-base !w-4 !h-4">{{ act.icon }}</mat-icon>
              {{ act.label }}
            </button>
          </div>
        </div>
        
      </div>
    </div>
  </div>
</div>

<style>
.form-field {
  margin-bottom: 1.5rem;
}
</style>