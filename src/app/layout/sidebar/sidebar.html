<div 
  class="h-full bg-white border-r border-gray-100 transition-all duration-300 ease-in-out relative"
  [ngClass]="isCollapsed ? 'w-20' : 'w-64'"
  style="box-shadow: 3px 0 20px rgba(91, 15, 20, 0.08);">

  <!-- Enhanced Toggle Button -->
  <button
    (click)="toggleSidebar()"
    class="absolute -right-4 top-8 w-8 h-8 bg-white border-2 border-[#5b0f14] rounded-full 
           flex items-center justify-center shadow-lg hover:shadow-2xl hover:scale-110 active:scale-95
           transition-all duration-300 z-10 group overflow-hidden">
    
    <!-- Background effect on hover -->
    <div class="absolute inset-0 bg-gradient-to-r from-[#5b0f14] to-[#7a1419] opacity-0 
                group-hover:opacity-100 transition-opacity duration-300 -z-10"></div>
    
    <!-- Button icon -->
    <mat-icon class="text-[#5b0f14] group-hover:text-white !text-base !w-4 !h-4 
                    transition-all duration-300 relative z-10"
              [ngClass]="{'rotate-180': isCollapsed}">
      {{ isCollapsed ? 'chevron_right' : 'chevron_left' }}
    </mat-icon>
    
    <!-- Ripple effect -->
    <div class="absolute inset-0 rounded-full bg-[#5b0f14] opacity-0 group-active:opacity-20 
                group-active:scale-150 transition-all duration-200"></div>
  </button>

  <!-- Navigation Content -->
  <div class="h-full overflow-y-auto px-3 py-6 scroll-smooth">
    <!-- ðŸ”¥ USE visibleModules HERE -->
    <div *ngFor="let module of visibleModules"
         routerLinkActive="module-active"
         [routerLinkActiveOptions]="{ exact: false }"
         class="mb-8">

      <!-- Active Module Indicator (Left Border) -->
      <div class="absolute -left-3 top-0 h-full w-[3px] bg-gradient-to-b from-[#5b0f14] to-[#9a2329] 
                  rounded-r-full opacity-0 module-active:opacity-100 transition-opacity duration-300
                  shadow-[0_0_8px_rgba(91,15,20,0.3)]"></div>

      <!-- MODULE NAME (Expanded) - Original Style Enhanced -->
      <div *ngIf="!isCollapsed"
           class="w-fit px-4 py-2 mb-3 font-semibold text-xs uppercase 
                  tracking-widest rounded-xl transition-all duration-300
                  text-gray-500 bg-gray-100/80 border border-gray-200/50
                  module-title group/module-header
                  module-active:bg-gradient-to-r module-active:from-[#5b0f14]/10 module-active:to-[#7a1419]/10
                  module-active:text-[#5b0f14] module-active:border-[#5b0f14]/20
                  module-active:shadow-sm module-active:font-bold">
        <div class="flex items-center gap-2">
          <!-- Module Icon in Header -->
          <div class="w-5 h-5 rounded-lg flex items-center justify-center 
                      bg-gradient-to-br from-[#5b0f14]/20 to-[#7a1419]/30
                      module-active:from-[#5b0f14]/30 module-active:to-[#7a1419]/40">
            <span class="text-[10px] font-bold text-[#5b0f14]">
              {{ module.name.substring(0, 1) }}
            </span>
          </div>
          {{ module.name }}
          <!-- Active Indicator -->
          <div class="w-1.5 h-1.5 rounded-full bg-[#5b0f14] opacity-0 
                      module-active:opacity-100 ml-1 transition-opacity duration-300"></div>
        </div>
      </div>

      <!-- MODULE NAME (Collapsed) - Original Style Enhanced -->
      <div *ngIf="isCollapsed" class="flex justify-center mb-3 relative">
        <div class="w-11 h-11 rounded-xl flex items-center justify-center
                    module-icon-collapsed bg-gradient-to-br from-[#5b0f14]/10 to-[#7a1419]/20
                    border border-gray-200/50 shadow-sm
                    module-active:from-[#5b0f14] module-active:to-[#7a1419] 
                    module-active:shadow-md group/module-collapsed">
          <span class="text-xs font-bold text-gray-600 uppercase transition-colors duration-300
                       module-active:text-white">
            {{ module.name.substring(0, 2) }}
          </span>
          
          <!-- Active Dot Indicator -->
          <div class="absolute -top-1 -right-1 w-2.5 h-2.5 rounded-full bg-[#5b0f14] 
                      border-2 border-white opacity-0 module-active:opacity-100 
                      transition-opacity duration-300 shadow-sm"></div>
        </div>
        
        <!-- Tooltip for Collapsed -->
        <div *ngIf="isCollapsed"
             class="absolute left-full ml-3 px-3 py-2 bg-gray-900 text-white 
                    text-xs rounded-lg opacity-0 invisible group-hover/module-collapsed:opacity-100 
                    group-hover/module-collapsed:visible transition-all duration-200 whitespace-nowrap 
                    pointer-events-none z-50 shadow-xl backdrop-blur-sm">
          {{ module.name }}
          <div class="absolute right-full top-1/2 -translate-y-1/2 
                      border-4 border-transparent border-r-gray-900"></div>
        </div>
      </div>

      <!-- MODULE NAV ITEMS -->
      <div class="space-y-1">
        <a
          *ngFor="let item of module.nav"
          [routerLink]="item.route"
          routerLinkActive="sidebar-active"
          [title]="isCollapsed ? item.label : ''"
          class="flex items-center gap-3 mb-1.5 rounded-xl
                 text-sm font-medium text-gray-700 hover:bg-gray-50/80
                 transition-all duration-200 group relative border border-transparent hover:border-gray-200/50"
          [ngClass]="isCollapsed ? 'justify-center py-3 px-2' : 'px-4 py-2.5'">

          <i *ngIf="item.icon"
             [class]="item.icon"
             class="text-lg text-gray-600 group-hover:text-[#5b0f14] transition-colors duration-200
                    sidebar-active:text-[#5b0f14]"></i>

          <span *ngIf="!isCollapsed" 
                class="group-hover:text-gray-900 transition-colors duration-200
                       sidebar-active:text-[#5b0f14] sidebar-active:font-semibold">
            {{ item.label }}
          </span>

          <!-- Active Item Indicator -->
          <div class="absolute -left-2 top-1/2 -translate-y-1/2 w-1.5 h-1.5 rounded-full 
                      bg-[#5b0f14] opacity-0 sidebar-active:opacity-100 
                      transition-opacity duration-300"></div>

          <!-- Tooltip (Collapsed) -->
          <div *ngIf="isCollapsed"
               class="absolute left-full ml-3 px-3 py-2 bg-gray-900 text-white 
                      text-xs rounded-lg opacity-0 invisible group-hover:opacity-100 
                      group-hover:visible transition-all duration-200 whitespace-nowrap 
                      pointer-events-none z-50 shadow-xl backdrop-blur-sm">
            {{ item.label }}
            <div class="absolute right-full top-1/2 -translate-y-1/2 
                        border-4 border-transparent border-r-gray-900"></div>
          </div>
        </a>
      </div>
    </div>
  </div>
</div>

<!-- Enhanced CSS -->
<style>
/* Active Module Header Styling - Enhanced */
.module-active .module-title {
  background: linear-gradient(135deg, rgba(91, 15, 20, 0.08) 0%, rgba(122, 20, 25, 0.08) 100%);
  color: #5b0f14 !important;
  border: 1px solid rgba(91, 15, 20, 0.2) !important;
  box-shadow: 0 2px 6px rgba(91, 15, 20, 0.15) !important;
  position: relative;
  font-weight: 700 !important;
  letter-spacing: 0.05em !important;
}

/* Active Module Collapsed Icon */
.module-active .module-icon-collapsed {
  background: linear-gradient(135deg, #5b0f14 0%, #7a1419 100%) !important;
  box-shadow: 0 3px 10px rgba(91, 15, 20, 0.3) !important;
  transform: scale(1.05);
  transition: all 0.3s ease;
}

.module-active .module-icon-collapsed span {
  color: white !important;
  font-weight: 700 !important;
}

/* Active nav item styling - More Subtle */
.sidebar-active {
  background: rgba(91, 15, 20, 0.06) !important;
  color: #5b0f14 !important;
  border: 1px solid rgba(91, 15, 20, 0.15) !important;
  box-shadow: 0 2px 6px rgba(91, 15, 20, 0.08) !important;
  font-weight: 600;
  position: relative;
  margin-left: 4px;
  transition: all 0.3s ease;
}

.sidebar-active i {
  color: #5b0f14 !important;
}

.sidebar-active span {
  color: #5b0f14 !important;
}

/* Optional: Add a subtle left accent for active nav items */
.sidebar-active::before {
  content: '';
  position: absolute;
  left: -4px;
  top: 50%;
  transform: translateY(-50%);
  width: 3px;
  height: 70%;
  background: linear-gradient(to bottom, #5b0f14, #7a1419);
  border-radius: 0 2px 2px 0;
  opacity: 0.8;
}

/* Remove the left accent for collapsed state */
:host-context([ngClass*="w-20"]) .sidebar-active::before {
  display: none;
}

/* Hover effects for non-active items */
a[routerLink]:not(.sidebar-active):hover {
  background: rgba(249, 250, 251, 0.9) !important;
  transform: translateX(2px);
  transition: all 0.2s ease;
}

/* Module header hover effect */
.module-title:hover {
  background: rgba(243, 244, 246, 0.9) !important;
  transform: translateX(2px);
  transition: all 0.2s ease;
}

/* Smooth scrollbar */
.h-full.overflow-y-auto {
  scrollbar-width: thin;
  scrollbar-color: #e5e7eb transparent;
}

.h-full.overflow-y-auto::-webkit-scrollbar {
  width: 5px;
}

.h-full.overflow-y-auto::-webkit-scrollbar-track {
  background: rgba(241, 241, 241, 0.5);
  border-radius: 10px;
  margin: 4px 0;
}

.h-full.overflow-y-auto::-webkit-scrollbar-thumb {
  background: linear-gradient(to bottom, #e5e7eb, #d1d5db);
  border-radius: 10px;
}

.h-full.overflow-y-auto::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(to bottom, #d1d5db, #9ca3af);
}

/* Animation for active module */
@keyframes moduleHighlight {
  0% {
    box-shadow: 0 0 0 0 rgba(91, 15, 20, 0.1);
  }
  70% {
    box-shadow: 0 0 0 6px rgba(91, 15, 20, 0);
  }
  100% {
    box-shadow: 0 0 0 0 rgba(91, 15, 20, 0);
  }
}

.module-active .module-title {
  animation: moduleHighlight 1s ease-out;
}

/* Responsive adjustments */
@media (max-height: 700px) {
  .h-full.overflow-y-auto {
    padding-top: 1rem;
    padding-bottom: 1rem;
  }
  
  .mb-8 {
    margin-bottom: 1.5rem;
  }
}
</style>